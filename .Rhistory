load("/Users/mahedi/Documents/UCL/scripts/R/Projects/Treatment-mediated-selection-of-lethal-prostate-cancer-clones-defined-by-copy-number-architectures/data.Rdata")
"%>%" <- magrittr::`%>%`
dndsout = dndscv::dndscv(clonal_mutations) %>% suppressWarnings
mutation_position_tib <- dndsout$annotmuts %>%
dplyr::filter((impact != "Synonymous")) %>%
dplyr::group_by(sampleID) %>%
dplyr::transmute(chr_pos = paste0(chr,"_", pos)) %>%
dplyr::summarise_all(., list) %>%
dplyr::mutate(cm_number=purrr::map_int(.x = chr_pos, .f =~ {.x %>% length})) %>%
tidyr::separate(col=sampleID, into=c("patientID", "sample"), sep="_",remove = F) %>%
dplyr::select(-sample) %>%
dplyr::group_by(patientID) %>%
tidyr::nest()
func_pct_common = function(sample_tibble){
res_list <- purrr::map(.x = combn(sample_tibble$sampleID,2, simplify = F),
.f =~ { (sample_tibble %>%
dplyr::filter(sampleID %in% .x) %>%
dplyr::pull(chr_pos) %>%
Reduce(intersect, .) %>%
length)/(sample_tibble %>%
dplyr::filter(sampleID %in% .x) %>%
dplyr::pull(cm_number) %>%
Reduce(min,.)) * 100
}
)
names(res_list) = purrr::map(.x = combn(sample_tibble$sampleID,2, simplify = F), .f = ~ paste(.x, collapse=" "))
return(do.call(rbind, res_list) %>% data.frame(pct_common=.) )
}
percent_common = purrr::map(.x = mutation_position_tib %>% dplyr::pull(data),
.f =func_pct_common) %>%
do.call(rbind,.)
df_stat <- percent_common %>%
as.data.frame %>%
merge(.,correlation_distances, by="row.names", all=T) %>%
dplyr::select(-Row.names)
p <- ggpubr::ggboxplot(df_stat, x="within_same_cluster", y="pct_common", fill="within_same_cluster") +
ggplot2::xlab("Within same cluster?") +
ggplot2::ylab("% common clonal non-silent mutations") +
ggplot2::labs(fill = "Within same cluster?")
p + ggpubr::stat_compare_means(method = "t.test")
label <-  paste("italic(R)^2==",(lm(pct_common ~ distance, data = df_stat) %>% summary)$r.squared %>% round(2))
plt <- ggplot2::ggplot(df_stat,ggplot2::aes(distance, pct_common, label=intersection)) +
ggplot2::geom_point(ggplot2::aes(fill=within_same_cluster), size=4, pch=21) +
ggplot2::geom_smooth(ggplot2::aes(distance, pct_common),method = "lm") +
ggplot2::xlab("Correlation distance") +
ggplot2::ylab("% common clonal non-silent mutations") +
ggplot2::theme_bw() +
ggplot2::annotate("text", x = 0.5, y=90, label=label, parse = T) +
ggplot2::labs(fill="Within same cluster?")
suppressWarnings(print(plt))
load("/Users/mahedi/Documents/UCL/scripts/R/Projects/Treatment-mediated-selection-of-lethal-prostate-cancer-clones-defined-by-copy-number-architectures/data.Rdata")
# load data:
load("./figure_data.RData")
# load data:
load("./figure_data.RData")
# set the pipe operator
"%>%" <- magrittr::`%>%`
a
# load data:
load("./figure_data.RData")
# set the pipe operator
"%>%" <- magrittr::`%>%`
# set the color palette:
cbPalette <- c(
"#999999",
"#E69F00",
"#56B4E9",
"#009E73",
"#F0E442",
"#0072B2",
"#D55E00",
"#CC79A7"
)
# plot SVs (start break-points) distribution at the AR locus
ggplot2::ggplot(data_fig3a, ggplot2::aes(start, yCoord, colour = Type)) +
ggplot2::annotate("rect", xmin = 66774465, xmax = 66950461, ymin = 0.5, ymax = 25.5, alpha = 0.5, fill = "salmon") +
ggplot2::annotate("rect", xmin = 66117800, xmax = 66128800, ymin = 0.5, ymax = 25.5, fill = "black") +
ggplot2::geom_point(shape = 73, size = 5) +
ggplot2::geom_hline(yintercept = c(0.5, data_fig3a$yCoord + 0.5), colour = "grey", linetype = 2, linewidth = 0.3) +
ggplot2::scale_colour_manual(values = cbPalette) +
ggplot2::scale_x_continuous(
name = "Chromosome X position (Mb)",
limits = c(4.3e7, 8e7),
breaks = seq(50e6, 80e6, 1e6),
labels = as.character(seq(50, 80))
) +
ggplot2::annotate("text", x = 4.4e7, y = data_fig3a$yCoord, label = data_fig3a$met, hjust = "left") +
ggplot2::theme_classic() +
ggplot2::theme(
axis.title.y = ggplot2::element_blank(),
axis.text.y = ggplot2::element_blank(),
axis.ticks.y = ggplot2::element_blank()
)
# load data
load("./figure_data.RData")
# plot normalized AR expression in PEA172 by clusters
ggplot2::ggplot(data = ARV12mimic, ggplot2::aes(x = clusterID, y = AR_norm)) +
ggplot2::geom_jitter(width = 0.1, ggplot2::aes(fill = ARV12mimic), size = 4, pch = 21) +
ggplot2::theme_classic() +
ggplot2::xlab("SCRATCH cluster") +
ggplot2::ylab("Normalized AR expression") +
ggplot2::scale_fill_discrete(name = "AR-V12 mimics")
# Load data
load("./figure_data.RData")
# set the pipe operator
"%>%" <- magrittr::`%>%`
# perform dndscv analysis
dndsout <- dndscv::dndscv(clonal_mutations) %>% suppressWarnings()
# extract synonymous mutation and calculate common clonal non-silent mutations
mutation_position_tib <- dndsout$annotmuts %>%
dplyr::filter((impact != "Synonymous")) %>%
dplyr::group_by(sampleID) %>%
dplyr::transmute(chr_pos = paste0(chr, "_", pos)) %>%
dplyr::summarise_all(., list) %>%
dplyr::mutate(cm_number = purrr::map_int(.x = chr_pos, .f = ~ {
.x %>% length()
})) %>%
tidyr::separate(col = sampleID, into = c("patientID", "sample"), sep = "_", remove = F) %>%
dplyr::select(-sample) %>%
dplyr::group_by(patientID) %>%
tidyr::nest()
func_pct_common <- function(sample_tibble) {
res_list <- purrr::map(
.x = combn(sample_tibble$sampleID, 2, simplify = F),
.f = ~ {
(sample_tibble %>%
dplyr::filter(sampleID %in% .x) %>%
dplyr::pull(chr_pos) %>%
Reduce(intersect, .) %>%
length()) / (sample_tibble %>%
dplyr::filter(sampleID %in% .x) %>%
dplyr::pull(cm_number) %>%
Reduce(min, .)) * 100
}
)
names(res_list) <- purrr::map(.x = combn(sample_tibble$sampleID, 2, simplify = F), .f = ~ paste(.x, collapse = " "))
return(do.call(rbind, res_list) %>% data.frame(pct_common = .))
}
percent_common <- purrr::map(
.x = mutation_position_tib %>% dplyr::pull(data),
.f = func_pct_common
) %>%
do.call(rbind, .)
df_stat <- percent_common %>%
as.data.frame() %>%
merge(., correlation_distances, by = "row.names", all = T) %>%
dplyr::select(-Row.names)
# test and plot the significance of percent common clonal non-silent mutation by cluster assignment
p <- ggpubr::ggboxplot(df_stat, x = "within_same_cluster", y = "pct_common", fill = "within_same_cluster") +
ggplot2::xlab("Within same cluster?") +
ggplot2::ylab("% common clonal non-silent mutations") +
ggplot2::labs(fill = "Within same cluster?")
p + ggpubr::stat_compare_means(method = "t.test")
# plot percent common clonal non-silent mutation as a function of correlatin distance between mets
label <- paste("italic(R)^2==", (lm(pct_common ~ distance, data = df_stat) %>% summary())$r.squared %>% round(2))
plt <- ggplot2::ggplot(df_stat, ggplot2::aes(distance, pct_common, label = intersection)) +
ggplot2::geom_point(ggplot2::aes(fill = within_same_cluster), size = 4, pch = 21) +
ggplot2::geom_smooth(ggplot2::aes(distance, pct_common), method = "lm") +
ggplot2::xlab("Correlation distance") +
ggplot2::ylab("% common clonal non-silent mutations") +
ggplot2::theme_bw() +
ggplot2::annotate("text", x = 0.5, y = 90, label = label, parse = T) +
ggplot2::labs(fill = "Within same cluster?")
suppressWarnings(print(plt))
df_stat
# load data
load("./figure_data.RData")
# plot normalized AR expression in PEA172 by clusters
ggplot2::ggplot(data = ARV12mimic, ggplot2::aes(x = clusterID, y = AR_norm)) +
ggplot2::geom_jitter(width = 0.1, ggplot2::aes(fill = ARV12mimic), size = 4, pch = 21) +
ggplot2::theme_classic() +
ggplot2::xlab("SCRATCH cluster") +
ggplot2::ylab("Normalized AR expression") +
ggplot2::scale_fill_discrete(name = "AR-V12 mimics")
ARV12mimic
?t.test()
library(dplyr)
head(ARV12mimic)
t.test(ARV12mimic %>% filter(ARV12mimic == "Yes") %>% pull(AR_norm), ARV12mimic %>% filter(ARV12mimic == "No") %>% pull(AR_norm))
t.test(ARV12mimic %>% filter(clusterID == "Cluster1") %>% pull(AR_norm), ARV12mimic %>% filter(AclusterID == "Cluster2") %>% pull(AR_norm))
t.test(ARV12mimic %>% filter(clusterID == "Cluster1") %>% pull(AR_norm), ARV12mimic %>% filter(clusterID == "Cluster2") %>% pull(AR_norm))
t.test(ARV12mimic %>% filter(clusterID == "Cluster1" & ARV12mimic == "Yes") %>% pull(AR_norm), ARV12mimic %>% filter(clusterID == "Cluster2" & ARV12mimic == "No") %>% pull(AR_norm))
la
ls
table(ARV12mimic$clusterID, ARV12mimic$ARV12mimic)
table(ARV12mimic$clusterID, ARV12mimic$ARV12mimic) %>% t.test()
table(ARV12mimic$ARV12mimic, ARV12mimic$clusterID) %>% t.test()
table(ARV12mimic$ARV12mimic, ARV12mimic$clusterID)
table(ARV12mimic$clusterID, ARV12mimic$ARV12mimic)
table(ARV12mimic$ARV12mimic, ARV12mimic$clusterID) %>% t.test()
table(ARV12mimic$ARV12mimic, ARV12mimic$clusterID) %>% fisher.test()
table(ARV12mimic$clusterID, ARV12mimic$ARV12mimic) %>% fisher.test()
#
# load data
load("./figure_data.RData")
# plot normalized AR expression in PEA172 by clusters
ggplot2::ggplot(data = ARV12mimic, ggplot2::aes(x = clusterID, y = AR_norm)) +
ggplot2::geom_jitter(width = 0.1, ggplot2::aes(fill = ARV12mimic), size = 4, pch = 21) +
ggplot2::theme_classic() +
ggplot2::xlab("SCRATCH cluster") +
ggplot2::ylab("Normalized AR expression") +
ggplot2::scale_fill_discrete(name = "AR-V12 mimics")
table(ARV12mimic$clusterID, ARV12mimic$ARV12mimic) %>%
fisher.test()
table(ARV12mimic$clusterID, ARV12mimic$ARV12mimic) %>%
fisher.test(alternative = "less")
table(ARV12mimic$clusterID, ARV12mimic$ARV12mimic) %>%
fisher.test(alternative = "greater")
table(ARV12mimic$clusterID, ARV12mimic$ARV12mimic) %>%
fisher.test(alternative = "two-sided")
# load data
load("./figure_data.RData")
View(autosomal_tree_CA63)
View(autosomal_tree_PEA172)
View(chrX_tree_CA63)
View(chrX_tree_PEA172)
